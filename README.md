# AutoCryptoTrader

基于 GitHub Actions 的免费云端模拟交易系统，每天自动运行 V5 集成策略（多子策略组合 + MA200过滤 + 唐奇安通道 + ATR止损）。

## 策略说明

### V5 集成策略核心逻辑

V5 策略采用**多子策略集成**的方式，通过组合4个不同参数的子策略来提高稳健性和降低过拟合风险：

1. **MA200 趋势过滤**: 所有子策略都只在长期趋势向上时开仓（收盘价 > MA200）
2. **唐奇安通道突破**: 每个子策略使用不同的周期判断突破信号
3. **ATR 追踪止损**: 每个子策略使用不同的ATR倍数设置止损线
4. **集成信号决策**: 根据子策略的加权平均持仓比例决定最终交易动作
   - 买入：当集成持仓比例 >= 50%（多数子策略看多）时买入
   - 卖出：当集成持仓比例 < 50%（多数子策略看空）或触及最保守止损线时卖出

### 策略参数

**基础参数**:
- 初始资金: 100,000 USDT
- 交易费率: 0.1%（双边收取）
- ATR计算周期: 14日
- MA200周期: 200日

**V5 集成策略配置（4个子策略，每个权重25%）**:
1. 子策略1: 唐奇安周期 20日, ATR倍数 5.0, 权重 25%
2. 子策略2: 唐奇安周期 30日, ATR倍数 4.5, 权重 25%
3. 子策略3: 唐奇安周期 40日, ATR倍数 4.0, 权重 25%
4. 子策略4: 唐奇安周期 50日, ATR倍数 3.5, 权重 25%

**交易决策规则**:
- 买入条件：集成持仓比例 >= 50% 且 价格 > MA200
- 卖出条件：集成持仓比例 < 50% 或 价格触及最保守止损线（所有持仓子策略中最高的止损线）

### 数据源

系统采用**双重数据源**机制，确保数据获取的可靠性：

1. **主要数据源**: Binance (通过 ccxt)
   - 优先使用币安交易所的实时数据
   - 数据质量高，延迟低

2. **备用数据源**: Yahoo Finance (通过 yfinance)
   - 当币安数据获取失败时自动切换
   - 使用 BTC-USD 交易对
   - 在 GitHub Actions 环境中可正常工作，无需额外配置

## 文件结构

```
AutoCryptoTrader/
├── simulation_trader.py      # 核心交易逻辑
├── requirements.txt          # Python依赖
├── .github/workflows/        # GitHub Actions配置
│   └── daily_run.yml
└── data/                     # 交易记录（自动生成）
    ├── portfolio_state.json  # 投资组合状态
    ├── trade_history.csv    # 交易历史记录
    └── daily_balance.csv    # 每日权益记录
```

## 自动化执行

系统每天 UTC 0:05（北京时间 8:05）自动运行一次，执行以下操作：

1. 加载投资组合状态（包括每个子策略的状态）
2. 获取最新市场数据（优先币安，失败则使用 Yahoo Finance）
3. 为每个子策略计算信号和状态
4. 根据集成策略逻辑计算加权平均持仓比例
5. 如有交易信号，执行买卖操作
6. 记录交易和每日权益
7. 自动提交数据到仓库

## 复盘文档

### 交易历史 (`data/trade_history.csv`)

记录所有买卖操作，包含：
- 时间戳
- 操作类型（BUY/SELL）
- 成交价格
- 交易原因
- 持仓数量
- 现金余额
- 总权益

### 每日权益 (`data/daily_balance.csv`)

记录每日投资组合权益，包含：
- 日期
- 现金余额
- 持仓数量
- 当前价格
- 总权益

用于绘制资金曲线和计算策略表现。

## 手动操作说明

### 本地运行

```bash
# 安装依赖
pip install -r requirements.txt

# 运行一次交易检查
python simulation_trader.py
```

### 查看交易记录

```bash
# 查看交易历史
cat data/trade_history.csv

# 查看每日权益
cat data/daily_balance.csv

# 查看当前状态
cat data/portfolio_state.json
```

### 手动触发 GitHub Actions

1. 访问仓库的 Actions 页面
2. 选择 "Daily Trading Simulation" 工作流
3. 点击 "Run workflow" 按钮

## 注意事项

- 所有交易均为**模拟交易**，不涉及真实资金
- 策略基于历史数据回测，不保证未来表现
- 数据文件会自动提交到仓库，请勿手动修改
- 如需重置策略，删除 `data/portfolio_state.json` 即可

## 技术栈

- Python 3.12+
- ccxt: 加密货币数据获取（主要数据源）
- yfinance: 备用数据源（Yahoo Finance）
- pandas: 数据处理
- numpy: 数值计算
- GitHub Actions: 自动化执行

## 策略优势

### 集成策略的优势

1. **降低过拟合风险**: 多子策略组合比单一参数策略更稳健
2. **提高信号质量**: 需要多数子策略一致才执行交易，减少假信号
3. **更保守的止损**: 使用所有持仓子策略中最保守的止损线，更好地保护资金
4. **与回测一致**: 使用与 V5 回测相同的策略配置，确保实盘与回测逻辑一致

---

**最后更新**: 2025-01-04
